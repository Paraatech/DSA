#include <iostream>
using namespace std;

struct Node {
    int data;
    Node* next;
    Node* prev;
    Node(int val) {
        data = val;
        next = nullptr;
        prev = nullptr;
    }
};

// Floydâ€™s Cycle Detection (Tortoise and Hare)
Node* detectLoop(Node* head) {
    Node* slow = head;
    Node* fast = head;

    while (fast != nullptr && fast->next != nullptr) {
        slow = slow->next;          // move 1 step
        fast = fast->next->next;    // move 2 steps
        if (slow == fast)
            return slow;  // meeting point
    }
    return nullptr; // no loop
}

Node* findLoopStart(Node* head) {
    Node* intersection = detectLoop(head);
    if (intersection == nullptr)
        return nullptr;

    Node* start = head;
    while (start != intersection) {
        start = start->next;
        intersection = intersection->next;
    }
    return start;
}

int main() {
    Node* head = new Node(12);
    head->next = new Node(22);
    head->next->prev = head;
    head->next->next = new Node(32);
    head->next->next->next = new Node(42);
    head->next->next->next->next = new Node(52);
    head->next->next->next->next->next = new Node(62);

    // Create loop: 62 -> 22
    head->next->next->next->next->next->next = head->next;

    Node* loopStart = findLoopStart(head);

    if (loopStart != nullptr)
        cout << "Loop detected at node with value: " << loopStart->data << endl;
    else
        cout << "No loop detected" << endl;

    return 0;
}
